<div class="page-header">
  <h2>All Pickup Requests</h2>
  <p>Monitor and manage all platform pickup requests</p>
</div>

<div *ngIf="successMsg" class="alert-wz success mb-3">{{ successMsg }}</div>
<div *ngIf="errorMsg" class="alert-wz error mb-3">{{ errorMsg }}</div>

<!-- Filters -->
<div class="card-wz mb-3">
  <div class="row g-3 form-wz align-items-end">
    <div class="col-md-4 form-group mb-0">
      <label>Search</label>
      <input type="text" [(ngModel)]="searchQuery" placeholder="Search by title..." />
    </div>
    <div class="col-md-3 form-group mb-0">
      <label>Status</label>
      <select [(ngModel)]="statusFilter">
        <option value="">All Statuses</option>
        <option>Open</option><option>Accepted</option><option>Completed</option><option>Cancelled</option>
      </select>
    </div>
    <div class="col-md-3 form-group mb-0">
      <label>Waste Type</label>
      <select [(ngModel)]="typeFilter">
        <option value="">All Types</option>
        <option *ngFor="let wt of wasteTypes.slice(1); trackBy: trackByIndex" [value]="wt">{{ wt }}</option>
      </select>
    </div>
    <div class="col-md-2">
      <button class="btn-wz-outline" (click)="searchQuery='';statusFilter='';typeFilter=''">Clear</button>
    </div>
  </div>
</div>

<div *ngIf="loading" class="text-center py-5"><div class="spinner-border text-success"></div></div>

<div class="card-wz" *ngIf="!loading">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <span class="text-muted" style="font-size:0.875rem">{{ filtered.length }} pickups</span>
  </div>
  <div class="table-responsive">
    <table class="table-wz w-100">
      <thead>
        <tr>
          <th>Title</th><th>User</th><th>Waste Type</th><th>Address</th>
          <th>Date</th><th>Status</th><th>Volunteer</th><th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of filtered; trackBy: trackById">
          <td style="font-weight:600">{{ p.title }}</td>
          <td>{{ getUser(p) }}</td>
          <td><span class="waste-tag waste-{{p.wasteType}}">{{ p.wasteType }}</span></td>
          <td style="max-width:150px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap" [title]="p.address">{{ p.address }}</td>
          <td>{{ p.preferredDate | date:'mediumDate' }}</td>
          <td><span class="badge-{{p.status.toLowerCase()}}">{{ p.status }}</span></td>
          <td>{{ getVolunteer(p) }}</td>
          <td>
            <div class="d-flex gap-1 flex-wrap">
              <button *ngIf="p.status === 'Accepted'" class="btn btn-sm btn-success" (click)="complete(p._id)" style="font-size:0.72rem">Complete</button>
              <button *ngIf="p.status !== 'Cancelled' && p.status !== 'Completed'" class="btn btn-sm btn-warning" (click)="cancel(p._id)" style="font-size:0.72rem">Cancel</button>
              <button class="btn btn-sm btn-outline-danger" (click)="deletePickup(p._id)" style="font-size:0.72rem"><i class="bi bi-trash"></i></button>
            </div>
          </td>
        </tr>
        <tr *ngIf="!filtered.length">
          <td colspan="8" class="text-center text-muted py-4">No pickups found</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
